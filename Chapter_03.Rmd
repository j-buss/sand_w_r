---
title: "Chapter 03"
output: html_document
date: '2023-06-02'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}
library(igraph)
library(sand)
```

Make a lattice graph of 5x5x5 and plot it by default.
```{r}
g.l <- make_lattice(c(5, 5, 5))
plot(g.l)
```
Load the aids web log dataset
```{r}
data("aidsblog")
summary(aidsblog)
```

Plot both datasets using a "layout_in_circle" option
```{r}
igraph_options(vertex.size=3, vertex.label=NA,
   edge.arrow.size=0.5)
par(mfrow=c(1, 2))
plot(g.l, layout=layout_in_circle)
title("5x5x5 Lattice")
plot(aidsblog, layout=layout_in_circle)
title("Blog Network")
```
Here we add the spring-embedder method to define a notion of force for each vertex. Specifically, using the Fruchterman and Reingold method
```{r}
plot(g.l,layout=layout_with_fr)
title("5x5x5 Lattice")
plot(aidsblog,layout=layout_with_fr)
title("Blog Network")
```

Apart from the spring embedder method we can use the energy-placement method. We use the Kamada and Kawai method
```{r}
plot(g.l, layout=layout_with_kk)
title("5x5x5 Lattice")
plot(aidsblog, layout=layout_with_kk)
title("Blog Network")
```

```{r}
g.tree <- graph_from_literal(1-+2,1-+3,1-+4,2-+5,2-+6,
                         2-+7,3-+8,3-+9,4-+10)
par(mfrow=c(1, 3))
igraph_options(vertex.size=30, edge.arrow.size=0.5,
   vertex.label=NULL)
plot(g.tree, layout=layout_in_circle)
plot(g.tree, layout=layout_as_tree(g.tree, circular=T))
plot(g.tree, layout=layout_as_tree)
```

```{r}
plot(g.bip, layout= -layout_as_bipartite(g.bip)[,2:1], 
   vertex.size=60, vertex.shape=ifelse(V(g.bip)$type, 
      "rectangle", "circle"),
   vertex.label.cex=1.75,
   vertex.color=ifelse(V(g.bip)$type, "red", "cyan"))
```

Load the karate data
```{r}
library(igraphdata)
data(karate)
```

set the seed to make the plot reproducible
create the layout using Kamada-Kawai algorithm
```{r}
set.seed(42)
l <- layout_with_kk(karate)
```
Plot the graph undecorated using the KK layout from previous step
```{r}
igraph_options(vertex.size=10)
par(mfrow=c(1,1))
plot(karate, layout=l, vertex.label=V(karate), 
   vertex.color=NA)
```
Show some of the components:
```{r}
sub("Actor ", "", V(karate)$name)
```

```{r}
V(karate)$Faction
```
```{r}
strength(karate)
```
```{r}
# Now decorate, starting with labels.
V(karate)$label <- sub("Actor ", "", V(karate)$name)
# Two leaders get shapes different from club members.
V(karate)$shape <- "circle"
V(karate)[c("Mr Hi", "John A")]$shape <- "rectangle"
# Differentiate two factions by color.
V(karate)[Faction == 1]$color <- "red"
V(karate)[Faction == 2]$color <- "dodgerblue"
# Vertex area proportional to vertex strength
# (i.e., total weight of incident edges).
V(karate)$size <- 4*sqrt(strength(karate))
V(karate)$size2 <- V(karate)$size * .5
# Weight edges by number of common activities
E(karate)$width <- E(karate)$weight
# Color edges by within/between faction.
F1 <- V(karate)[Faction==1]
F2 <- V(karate)[Faction==2]
E(karate)[ F1 %--% F1 ]$color <- "pink"
E(karate)[ F2 %--% F2 ]$color <- "lightblue"
E(karate)[ F1 %--% F2 ]$color <- "yellow"
# Offset vertex labels for smaller points (default=0).
V(karate)$label.dist <- 
   ifelse(V(karate)$size >= 9.0, 0, 1.0)
# Plot decorated graph, using same layout.
plot(karate, layout=l)
```

# Office location indicated by color.
```{r}
colbar <- c("red", "dodgerblue", "goldenrod")
v.colors <- colbar[V(lazega)$Office]
```
# Type of practice indicated by vertex shape.
```{r}
v.shapes <- c("circle", "square")[V(lazega)$Practice]
```
# Vertex size proportional to years with firm.
```{r}
v.size <- 3.5*sqrt(V(lazega)$Years)
```
# Label vertices according to seniority.
```{r}
v.label <- V(lazega)$Seniority
```
# Reproducible layout.
```{r}
set.seed(42)
l <- layout_with_fr(lazega)
plot(lazega, layout=l, vertex.color=v.colors,
   vertex.shape=v.shapes, vertex.size=v.size,
   vertex.label=v.label)
```


```{r}
summary(fblog)
```
```{r}
party.names <- sort(unique(V(fblog)$PolParty))
party.names
```

```{r}
set.seed(42)
l = layout_with_kk(fblog)
party.nums.f <- as.factor(V(fblog)$PolParty)
party.nums <- as.numeric(party.nums.f)
```
# igraph color palette has 8 colors
# 9 colors needed (for 9 political parties)
```{r}
library(RColorBrewer)
colrs <- brewer.pal(9,"Set1")
V(fblog)$color <- colrs[party.nums]
plot(fblog, layout=l, vertex.label=NA,
      vertex.size=3)
```
```{r}
set.seed(42)
l <- layout_with_drl(fblog)
plot(fblog, layout=l, vertex.size=5, vertex.label=NA)
```

```{r}
fblog.c <- contract(fblog, party.nums)
E(fblog.c)$weight <- 1
fblog.c <- simplify(fblog.c)
```

```{r}
party.size <- as.vector(table(V(fblog)$PolParty))
plot(fblog.c, vertex.size=5*sqrt(party.size),
      vertex.label=party.names, vertex.color=colrs,
      edge.width=sqrt(E(fblog.c)$weight),
      vertex.label.dist=3.5, edge.arrow.size=0)
```

```{r}
data(karate)
k.nbhds <- make_ego_graph(karate, order=1)
```

```{r}
sapply(k.nbhds, vcount)
```

```{r}
k.1 <- k.nbhds[[1]]
k.34 <- k.nbhds[[34]]
par(mfrow=c(1,2))
plot(k.1, vertex.label=NA,
   vertex.color=c("red", rep("lightblue", 16)))
plot(k.34, vertex.label=NA,
   vertex.color=c(rep("lightblue", 17), "red"))
```